= Audio

[NOTE]
====
This page is a work in progress.
====

== Wwise

Coffee Stain uses the Wwise audio system to play sounds in Satisfactory.

To create new audio events to play in your mod, you will need the Wwise project set up and integrated into the SML project.

=== Setting Up Audio Buses

By default when using Wwise audio only the `Master` volume slider will work.

You will need to manually create the different Audio Buses that link to the other sliders.

TODO: Waiting for CSS to provide the correct audio bus names.

=== Importing Media Files to Wwise

Open the Wwise project file, typically in `SMLProject/SMLProject_WwiseProject/SMLProject_WwiseProject.wproj`. Double-clicking this file will open Wwise.

To make sure you are in the correct layout at the top, go to `Layout -> Designer`

On the left-hand side, you will see the project explorer; select the Audio Tab.

image:Satisfactory/Wwise/Wwise_Image1.png[Wwise_Image1, 350]

Under `Actor-Mixer Hierarchy`, there will be `Default Work Unit`

To keep everything organized, create a new Virtual Folder and name it the same as your mod:

image:Satisfactory/Wwise/Wwise_Image2.png[Wwise_Image2, 600]

Now, to import audio files!

Drag your `.wav` files into this newly created Virtual Folder. The `Audio File Importer` window will show.

image:Satisfactory/Wwise/Wwise_Image3.png[Wwise_Image3, 600]

Ensure that you have `Create New Objects` selected under import mode. Verify it is going to the correct folder and then click `Import`

That's It. Your audio files are now imported to Wwise!

=== Creating Audiokinetic Events

Audiokinetic Events trigger audio events like Play, Pause, Stop, etc.
These are typically referred to as `AKEvents`

To play the audio in your mod, you will need to create an event in Wwise. First, make sure that you have followed the above steps to import your `.wav` files to Wwise.

In Project Explorer, go to the Audio tab and locate the audio for which you want to create an event.

Right-click the audio and select `New Event -> Play`. This will create a new Play event.

image:Satisfactory/Wwise/Wwise_Image4.png[Wwise_Image4, 600]

In the Project Explorer, go to the Events tab, and you should see the event `Play_<AudioName>`.

Double-clicking the event will show the Event's details in the main center section.

There are a few things to take note and verify:

* Take a note of the Event ID (Marked in Red)
* Make sure that Inclusion is checked (Marked In Green)
* Verify that the target is for the correct audio (Marked In Blue)

image:Satisfactory/Wwise/Wwise_Image5.png[Wwise_Image5, 600]

Repeat the process for all other audio you want to play in your mod.

[NOTE]
====
Create a new Virtual Folder to store the Events for ease and organization.
====

=== Creating Audiokinetic Soundbanks

You will need to create a new Soundbank for all your Events to be stored.

In Wwise, change the layout to Soundbanks. This can be found at the top under `Layouts -> Soundbanks`.

Select the `Soundbanks` tab in the Project Explorer on the left.


By default, you will have the following tree structure:

image:Satisfactory/Wwise/Wwise_Image6.png[Wwise_Image6, 600]

Create a new Soundbank by Right-clicking the `Default Work Unit` then `New Child -> Soundbank`

image:Satisfactory/Wwise/Wwise_Image7.png[Wwise_Image7, 600]

Name the Soundbank `ModName_Soundbank`. This is optional and can be named however you want.

Double-click the newly created Soundbank, which will open in a new window.

In the main Wwise window, navigate to the Events tab in the Project Explorer.

With the Soundbank window still open, drag the `Default Work Unit` or, if you created a Virtual Folder for your event, drag this to the Soundbank window.

image:Satisfactory/Wwise/Wwise_Image8.png[Wwise_Image8, 700]

Go to the `Edit` tab to verify that all the events are included in the Soundbank.

image:Satisfactory/Wwise/Wwise_Image9.png[Wwise_Image9, 600]

Now, it's finally time to generate the Soundbank for Unreal Engine.

In the Project Explorer, on the Soundbanks tab, right-click on the soundbank and click `Generate Soundbank(s) for all platforms`.

image:Satisfactory/Wwise/Wwise_Image10.png[Wwise_Image10, 500]

=== Creating AKEvents In Unreal Engine

Open the Unreal Engine project settings and Navigate to the Wwise integration settings.

Change the `Root Output Path` setting to `<WwiseProjectPath>/GeneratedSoundBanks`.

Then Change the `Unreal Audio Routing` to `Both Wwise and Unreal audio`

You may need to restart Unreal after these changes.

Once your audio, event, and soundbanks are created, it's time to utilize them in the Unreal Engine.

Create a new Audiokinetic Event by right-clicking on an empty area in the Content Browser.

Go To `Audiokinetic -> Audiokinetic Event`

image:Satisfactory/Wwise/Wwise_Image11.png[Wwise_Image11, 500]

Name the new asset **Exactly** the same name as the event in Wwise.

[NOTE]
====
If the asset name is exactly the same as the Wwise event, Unreal Engine will automatically populate the correct event information to the variables below.
====

Verify that the event has the correct information by opening the event in Unreal.

* Verify that the `Wwise Short ID` matches the event ID in Wwise.
* Verify the `Wwise Name` matches the event name.

image:Satisfactory/Wwise/Wwise_Image12.png[Wwise_Image12, 500]

If everything has worked correctly, you can now test the event by right-clicking the event in Unreal and clicking `Play Event`

=== Playing AKEvents In Blueprints

==== Fire & Forget Events

If you would like to play a one off AK event, for example a spark sound. Then you will need to use the following method in your blueprint.

image:Satisfactory/Wwise/Wwise_Image13.png[Wwise_Image13, 100%]

This will first create a new `AK Component` at the root component of the blueprint then play the AK Event specified.

You will need to make sure that you cleanup the `AK Component` once the AK Event has ended. This can be done using the callback event.

==== Looping Events

If you would like to play a sound effect that might loop, for example a humming/buzzing sound for a building.

Then the best method will be to add a `AK Component` to your blueprint and set the `AK Audio Event` variable on the component.

You will need to ensure that you stop the event when the actor is destroyed.

image:Satisfactory/Wwise/Wwise_Image14.png[Wwise_Image14, 100%]


=== Setting Up Attenuation

If you are planning of using Wwise for buildings you will need to setup attenuation. By default the audio will play even if you are the otherside of the map.

Wwise has a great tutorial on how to set this up here: https://youtu.be/lOP0seni1DY[Wwise & Unreal | Adding 3D Audio With Attenuation]

=== Updating Wwise Values From Your Mod

You can update audio values using RTPC (Game Parameters).

In your Wwise project go to the Project Explorer and go to the `Game Syncs` tab.

Under `Game Parameters -> Default Work Unit` create a new game parameter by right-clicking the `Default Work Unit` then `New Child -> Game Parameter`

image:Satisfactory/Wwise/Wwise_Image15.png[Wwise_Image15, 100%]

Name this what ever you want.

Open the newly created Game Parameter and you should see the following in the main section.

image:Satisfactory/Wwise/Wwise_Image17.png[Wwise_Image17, 100%]

You will need to set the range, I recommend using 0 to 1.

Now to assign the RTPC Game Parameter to your audio.

Open your Audio then go to the `RTPC` tab. Click the `>>` in the main section to set what you are going to update, in this case I want to update the `Voice Volume`.

Then click the `>>` to the right of the first one and select you game parameter.

image:Satisfactory/Wwise/Wwise_Image16.png[Wwise_Image16, 500]

Once that is done you should see something similar to the following:

image:Satisfactory/Wwise/Wwise_Image18.png[Wwise_Image18, 100%]

Now create the Game Parameter in Unreal Engine.

image:Satisfactory/Wwise/Wwise_Image19.png[Wwise_Image19, 500]

Name it exactly the same as you have in Wwise.

You can now update the RTPC Game Parameter value using blueprints:

image:Satisfactory/Wwise/Wwise_Image20.png[Wwise_Image20, 700]

== ADA

See the xref:Development/Satisfactory/AdaMessages.adoc[dedicated page on ADA Messages] for more information.

== Volume Options

To retrieve the user's volume options, use "Get FGGame User Settings" and "Get Float Option Value".

To find out what CVARs to use in,
adjusting your own user setting for the value then checking your
xref:faq.adoc#Files_GameConfig[GameUserSettings.ini file] to see what they are saved as.

As of the 1.0 release update, these are the CVARs for the main volume categories:

// cspell:ignore Menu_Volume_Vehicules
```
RTPC.Menu_Volume_Master
RTPC.Menu_Volume_Dialogue
RTPC.Menu_Volume_SoundEffects
RTPC.Menu_Volume_UI
RTPC.Music_Bus_Volume
RTPC.Menu_Volume_Ambience
RTPC.Consumables_Bus_Volume
RTPC.Menu_Volume_Creatures
RTPC.Menu_Volume_Equipment
RTPC.Menu_Volume_Factory
RTPC.Menu_Volume_Foley
RTPC.Menu_Volume_Vehicules
RTPC.Menu_Volume_Weapons
```

These values are on a scale of `0.0` (off) to `1.0` (full volume).
If multiple categories apply, multiply them together to reach the final volume value.
For example, the Chainsaw's volume is probably Master multiplied with Equipment multiplied with the chainsaw's specific category.
